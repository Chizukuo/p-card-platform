package com.example.pcard.util;

import java.util.HashMap;
import java.util.Map;

/**
 * 中文简繁体转换工具类
 * 用于搜索时支持简体繁体互相匹配
 */
public class ChineseConverter {
    
    // 常用繁体到简体的映射表
    private static final Map<Character, Character> T2S_MAP = new HashMap<>();
    // 常用简体到繁体的映射表
    private static final Map<Character, Character> S2T_MAP = new HashMap<>();
    
    static {
        // 初始化常用简繁体字符映射（仅列出最常用的字符以优化性能）
        initCommonMappings();
    }
    
    /**
     * 将繁体字转换为简体字
     * @param text 原始文本
     * @return 转换后的简体文本
     */
    public static String toSimplified(String text) {
        if (text == null || text.isEmpty()) {
            return text;
        }
        
        StringBuilder result = new StringBuilder(text.length());
        for (char c : text.toCharArray()) {
            result.append(T2S_MAP.getOrDefault(c, c));
        }
        return result.toString();
    }
    
    /**
     * 将简体字转换为繁体字
     * @param text 原始文本
     * @return 转换后的繁体文本
     */
    public static String toTraditional(String text) {
        if (text == null || text.isEmpty()) {
            return text;
        }
        
        StringBuilder result = new StringBuilder(text.length());
        for (char c : text.toCharArray()) {
            result.append(S2T_MAP.getOrDefault(c, c));
        }
        return result.toString();
    }
    
    /**
     * 生成搜索时使用的多种变体（原文 + 简体 + 繁体）
     * 去重后返回，用于构建多条件搜索
     * @param text 原始搜索文本
     * @return 包含原文、简体、繁体的数组（已去重）
     */
    public static String[] getSearchVariants(String text) {
        if (text == null || text.isEmpty()) {
            return new String[]{text};
        }
        
        String original = text;
        String simplified = toSimplified(text);
        String traditional = toTraditional(text);
        
        // 去重：如果转换后相同，则不重复添加
        if (original.equals(simplified) && original.equals(traditional)) {
            return new String[]{original};
        } else if (original.equals(simplified)) {
            return new String[]{original, traditional};
        } else if (original.equals(traditional)) {
            return new String[]{original, simplified};
        } else if (simplified.equals(traditional)) {
            return new String[]{original, simplified};
        } else {
            return new String[]{original, simplified, traditional};
        }
    }
    
    /**
     * 初始化常用简繁体映射
     * 仅包含最常用的字符以优化性能和内存占用
     */
    private static void initCommonMappings() {
        // 常用简繁体对照（按使用频率选择）
        String[][] mappings = {
            // 繁体, 简体
            {"愛", "爱"}, {"動", "动"}, {"們", "们"}, {"來", "来"}, {"時", "时"},
            {"個", "个"}, {"國", "国"}, {"會", "会"}, {"長", "长"}, {"門", "门"},
            {"開", "开"}, {"見", "见"}, {"現", "现"}, {"無", "无"}, {"關", "关"},
            {"東", "东"}, {"馬", "马"}, {"區", "区"}, {"陽", "阳"}, {"車", "车"},
            {"記", "记"}, {"聲", "声"}, {"業", "业"}, {"產", "产"}, {"電", "电"},
            {"華", "华"}, {"學", "学"}, {"萬", "万"}, {"實", "实"}, {"報", "报"},
            {"場", "场"}, {"發", "发"}, {"問", "问"}, {"號", "号"}, {"員", "员"},
            {"經", "经"}, {"體", "体"}, {"將", "将"}, {"應", "应"}, {"書", "书"},
            {"點", "点"}, {"過", "过"}, {"進", "进"}, {"運", "运"}, {"還", "还"},
            {"這", "这"}, {"邊", "边"}, {"達", "达"}, {"樣", "样"}, {"標", "标"},
            {"讀", "读"}, {"語", "语"}, {"認", "认"}, {"議", "议"}, {"護", "护"},
            {"際", "际"}, {"雙", "双"}, {"頭", "头"}, {"麗", "丽"}, {"類", "类"},
            {"廣", "广"}, {"機", "机"}, {"歡", "欢"}, {"氣", "气"}, {"漢", "汉"},
            {"環", "环"}, {"當", "当"}, {"療", "疗"}, {"確", "确"}, {"網", "网"},
            {"統", "统"}, {"義", "义"}, {"聯", "联"}, {"藝", "艺"}, {"處", "处"},
            {"規", "规"}, {"設", "设"}, {"評", "评"}, {"談", "谈"}, {"質", "质"},
            {"貴", "贵"}, {"農", "农"}, {"達", "达"}, {"選", "选"}, {"錄", "录"},
            {"陸", "陆"}, {"雜", "杂"}, {"難", "难"}, {"響", "响"}, {"領", "领"},
            {"題", "题"}, {"願", "愿"}, {"類", "类"}, {"顯", "显"}, {"風", "风"},
            {"飛", "飞"}, {"養", "养"}, {"館", "馆"}, {"廳", "厅"}, {"為", "为"},
            {"從", "从"}, {"對", "对"}, {"導", "导"}, {"後", "后"}, {"總", "总"},
            {"據", "据"}, {"極", "极"}, {"樣", "样"}, {"權", "权"}, {"歷", "历"},
            {"準", "准"}, {"濟", "济"}, {"營", "营"}, {"獨", "独"}, {"環", "环"},
            {"畫", "画"}, {"療", "疗"}, {"眾", "众"}, {"積", "积"}, {"種", "种"},
            {"稱", "称"}, {"節", "节"}, {"藏", "藏"}, {"衛", "卫"}, {"裝", "装"},
            {"觀", "观"}, {"計", "计"}, {"試", "试"}, {"該", "该"}, {"詢", "询"},
            {"證", "证"}, {"識", "识"}, {"變", "变"}, {"負", "负"}, {"財", "财"},
            {"較", "较"}, {"軍", "军"}, {"輕", "轻"}, {"連", "连"}, {"適", "适"},
            {"選", "选"}, {"錯", "错"}, {"險", "险"}, {"際", "际"}, {"雖", "虽"},
            {"靈", "灵"}, {"須", "须"}, {"劉", "刘"}, {"張", "张"}, {"陳", "陈"},
            {"楊", "杨"}, {"黃", "黄"}, {"趙", "赵"}, {"吳", "吴"}, {"週", "周"},
            {"鄭", "郑"}, {"謝", "谢"}, {"許", "许"}, {"專", "专"}, {"師", "师"},
            {"幣", "币"}, {"態", "态"}, {"憶", "忆"}, {"戰", "战"}, {"擇", "择"},
            {"據", "据"}, {"斷", "断"}, {"條", "条"}, {"檢", "检"}, {"歐", "欧"},
            {"況", "况"}, {"測", "测"}, {"減", "减"}, {"濟", "济"}, {"煙", "烟"},
            {"熱", "热"}, {"獲", "获"}, {"獻", "献"}, {"狀", "状"}, {"獨", "独"},
            {"異", "异"}, {"當", "当"}, {"痛", "痛"}, {"盡", "尽"}, {"眾", "众"},
            {"礎", "础"}, {"確", "确"}, {"禮", "礼"}, {"離", "离"}, {"種", "种"},
            {"稅", "税"}, {"穩", "稳"}, {"競", "竞"}, {"築", "筑"}, {"範", "范"},
            {"約", "约"}, {"紀", "纪"}, {"純", "纯"}, {"紛", "纷"}, {"納", "纳"},
            {"終", "终"}, {"組", "组"}, {"結", "结"}, {"給", "给"}, {"絕", "绝"},
            {"綠", "绿"}, {"維", "维"}, {"網", "网"}, {"緊", "紧"}, {"線", "线"},
            {"編", "编"}, {"練", "练"}, {"縣", "县"}, {"總", "总"}, {"績", "绩"},
            {"繼", "继"}, {"續", "续"}, {"縮", "缩"}, {"羅", "罗"}, {"義", "义"},
            {"習", "习"}, {"聖", "圣"}, {"聞", "闻"}, {"聯", "联"}, {"聰", "聪"},
            {"職", "职"}, {"聽", "听"}, {"肅", "肃"}, {"與", "与"}, {"興", "兴"},
            {"舊", "旧"}, {"藍", "蓝"}, {"術", "术"}, {"衆", "众"}, {"補", "补"},
            {"裡", "里"}, {"製", "制"}, {"複", "复"}, {"觸", "触"}, {"訊", "讯"},
            {"討", "讨"}, {"訓", "训"}, {"託", "托"}, {"訪", "访"}, {"設", "设"},
            {"許", "许"}, {"診", "诊"}, {"註", "注"}, {"詳", "详"}, {"試", "试"},
            {"詩", "诗"}, {"話", "话"}, {"該", "该"}, {"詳", "详"}, {"誌", "志"},
            {"認", "认"}, {"誤", "误"}, {"說", "说"}, {"課", "课"}, {"誰", "谁"},
            {"調", "调"}, {"談", "谈"}, {"請", "请"}, {"論", "论"}, {"諸", "诸"},
            {"謀", "谋"}, {"講", "讲"}, {"謝", "谢"}, {"證", "证"}, {"識", "识"},
            {"譯", "译"}, {"議", "议"}, {"護", "护"}, {"譽", "誉"}, {"讀", "读"},
            {"變", "变"}, {"讓", "让"}, {"贊", "赞"}, {"贏", "赢"}, {"質", "质"},
            {"賣", "卖"}, {"賞", "赏"}, {"賴", "赖"}, {"購", "购"}, {"資", "资"},
            {"賓", "宾"}, {"賽", "赛"}, {"贈", "赠"}, {"趨", "趋"}, {"越", "越"},
            {"趙", "赵"}, {"跡", "迹"}, {"踐", "践"}, {"躍", "跃"}, {"軌", "轨"},
            {"較", "较"}, {"載", "载"}, {"輔", "辅"}, {"輯", "辑"}, {"輪", "轮"},
            {"輸", "输"}, {"轉", "转"}, {"轟", "轰"}, {"辦", "办"}, {"農", "农"},
            {"迴", "回"}, {"逼", "逼"}, {"遊", "游"}, {"運", "运"}, {"遍", "遍"},
            {"過", "过"}, {"達", "达"}, {"違", "违"}, {"遙", "遥"}, {"遠", "远"},
            {"適", "适"}, {"遲", "迟"}, {"遷", "迁"}, {"選", "选"}, {"遺", "遗"},
            {"邁", "迈"}, {"還", "还"}, {"邊", "边"}, {"郵", "邮"}, {"鄉", "乡"},
            {"鄰", "邻"}, {"鄭", "郑"}, {"鄧", "邓"}, {"酈", "郦"}, {"釋", "释"},
            {"鍵", "键"}, {"鍊", "炼"}, {"鍾", "钟"}, {"鎖", "锁"}, {"鎮", "镇"},
            {"鏡", "镜"}, {"鐘", "钟"}, {"鐵", "铁"}, {"鑑", "鉴"}, {"鑒", "鉴"},
            {"鑰", "钥"}, {"長", "长"}, {"門", "门"}, {"閉", "闭"}, {"開", "开"},
            {"閑", "闲"}, {"間", "间"}, {"閣", "阁"}, {"關", "关"}, {"閱", "阅"},
            {"闊", "阔"}, {"隊", "队"}, {"階", "阶"}, {"際", "际"}, {"隨", "随"},
            {"險", "险"}, {"隱", "隐"}, {"雋", "隽"}, {"難", "难"}, {"雖", "虽"},
            {"雙", "双"}, {"雜", "杂"}, {"離", "离"}, {"雲", "云"}, {"電", "电"},
            {"霧", "雾"}, {"靈", "灵"}, {"靜", "静"}, {"韓", "韩"}, {"響", "响"},
            {"頁", "页"}, {"頂", "顶"}, {"項", "项"}, {"順", "顺"}, {"須", "须"},
            {"頌", "颂"}, {"預", "预"}, {"頑", "顽"}, {"頓", "顿"}, {"頗", "颇"},
            {"領", "领"}, {"頭", "头"}, {"頻", "频"}, {"顆", "颗"}, {"題", "题"},
            {"額", "额"}, {"顏", "颜"}, {"願", "愿"}, {"類", "类"}, {"顧", "顾"},
            {"顫", "颤"}, {"顯", "显"}, {"風", "风"}, {"飄", "飘"}, {"飛", "飞"},
            {"餐", "餐"}, {"餘", "余"}, {"館", "馆"}, {"餓", "饿"}, {"餘", "余"},
            {"餅", "饼"}, {"養", "养"}, {"餘", "余"}, {"餾", "馏"}, {"駁", "驳"},
            {"駐", "驻"}, {"駕", "驾"}, {"駛", "驶"}, {"駝", "驼"}, {"駱", "骆"},
            {"騎", "骑"}, {"騙", "骗"}, {"騰", "腾"}, {"騷", "骚"}, {"驅", "驱"},
            {"驗", "验"}, {"驚", "惊"}, {"驛", "驿"}, {"骯", "肮"}, {"髓", "髓"},
            {"體", "体"}, {"髮", "发"}, {"鬥", "斗"}, {"鬧", "闹"}, {"魂", "魂"},
            {"魚", "鱼"}, {"魯", "鲁"}, {"鮮", "鲜"}, {"鳥", "鸟"}, {"鳳", "凤"},
            {"鳴", "鸣"}, {"鴻", "鸿"}, {"鵬", "鹏"}, {"鶴", "鹤"}, {"鷹", "鹰"},
            {"麗", "丽"}, {"麥", "麦"}, {"麵", "面"}, {"黃", "黄"}, {"黑", "黑"},
            {"黨", "党"}, {"黿", "鼋"}, {"鼓", "鼓"}, {"鼠", "鼠"}, {"齊", "齐"},
            {"齡", "龄"}, {"齒", "齿"}, {"齡", "龄"}, {"龍", "龙"}, {"龐", "庞"},
            {"龔", "龚"}, {"龜", "龟"}
        };
        
        // 填充映射表
        for (String[] pair : mappings) {
            char traditional = pair[0].charAt(0);
            char simplified = pair[1].charAt(0);
            T2S_MAP.put(traditional, simplified);
            S2T_MAP.put(simplified, traditional);
        }
    }
    
    /**
     * 检查字符串是否包含中文字符
     * @param text 待检查的文本
     * @return 是否包含中文
     */
    public static boolean containsChinese(String text) {
        if (text == null || text.isEmpty()) {
            return false;
        }
        for (char c : text.toCharArray()) {
            if (c >= 0x4E00 && c <= 0x9FFF) {
                return true;
            }
        }
        return false;
    }
}
